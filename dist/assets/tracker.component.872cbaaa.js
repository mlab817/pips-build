import{r as n,a9 as k,u as V,b as o,F as w,j as a,$ as z,x as K,S as x,B as C,al as H,a2 as J,D as Q,ab as W,A as f,a4 as X,aI as c,h as Y,q as Z,M as ee,aJ as te,aK as ae,aL as se,aM as P,Q as ie,aN as ne,n as d}from"./vendor.f6fa5c08.js";import{b as oe,I as re,C as le,a as b,P as I,e as O}from"./index.c2c60e57.js";import{O as ce}from"./index.bb59335a.js";import{U as de}from"./index.c6851cee.js";import{T as ue}from"./table-search.component.fb71bfc0.js";import{R as pe}from"./download-button.component.05762bcb.js";import"./new-button.component.9cb43db0.js";const we=()=>{const[v,T]=n.exports.useState([]),[E,A]=n.exports.useState({}),[g,y]=n.exports.useState(1),[L,u]=n.exports.useState(!1),[p,R]=n.exports.useState(""),[D,_]=n.exports.useState(!1),[m]=k.useForm();oe();const N=[{title:"Project Title",dataIndex:"title",key:"title"},{title:"Office",dataIndex:"office",key:"office_id",render:(e,t)=>{var s,i;return a(ce,{office:t.office,children:a(f,{style:{backgroundColor:(s=t.office)==null?void 0:s.color},children:(i=t.office)==null?void 0:i.acronym})})},align:"center"},{title:"Issues",dataIndex:"issues_count",key:"issues_count",align:"center",render:(e,t)=>t.issues_count>0?t.issues_count:a(X,{style:{color:le.green}})},{title:"PIPS",dataIndex:"pips_status",key:"pips_status_id",render:(e,t)=>{var s,i,l;return a(c,{color:(s=t.pips_status)==null?void 0:s.color,children:(l=(i=t.pips_status)==null?void 0:i.name)==null?void 0:l.toUpperCase()})},align:"center"},{title:"Passed Validation",dataIndex:"passes_validation",key:"passes_validation",align:"center",render:e=>{switch(e){case 1:return a(c,{color:"green",children:"PASSED"});case-1:return a(c,{color:"red",children:"FAILED"});default:return a(c,{color:"geekblue",children:"PENDING"})}}},{title:"Overall Remarks",dataIndex:"remarks",key:"remarks",align:"center",render:(e,t)=>{var s;return(s=t.checklist)==null?void 0:s.overall_remarks}},{title:"PIPOL",dataIndex:"pipol_status",key:"pipol_status_id",render:(e,t)=>{var s,i,l;return a(c,{color:(s=t.pipol_status)==null?void 0:s.color,children:(l=(i=t.pipol_status)==null?void 0:i.name)==null?void 0:l.toUpperCase()})},align:"center"},{title:"Reviewers",dataIndex:"reviewers",key:"reviewers",render:e=>a(f.Group,{children:e.map((t,s)=>a(de,{user:t,children:a(f,{style:{backgroundColor:t.color},children:t.avatar})},s))}),align:"center"},{title:"Last Updated",dataIndex:"updated_at",key:"updated_at",render:e=>Y(e).fromNow(),align:"center"},{title:"Actions",dataIndex:"actions",key:"actions",render:(e,t)=>a(x,{children:a(Z.Button,{overlay:a(ee,{style:{width:150},items:[{label:"Edit",key:1,icon:a(te,{}),onClick:()=>S(`/pips/${t.uuid}`),disabled:!t.permissions.view},{label:"Drop",key:2,icon:a(ae,{}),onClick:()=>G(t),disabled:!t.permissions.drop},{label:"Print",key:3,icon:a(se,{}),onClick:()=>U(t)},{type:"divider"},{label:"Lock",key:4,icon:a(P,{}),onClick:()=>q(t),disabled:!t.permissions.lock}]})})}),align:"center"}],S=V(),U=e=>{window.open(`/pips/${e.uuid}/print`,{target:"_blank"})},h=async()=>{u(!0);try{const e=await b.get("/tracker",{params:{page:g,q:p}});T(e.data.data),A(e.data.meta.pagination),u(!1)}catch(e){message.error(e.response.data.message),u(!1)}};n.exports.useEffect(()=>{h()},[g,p]);const j=e=>y(e),F=e=>{y(1),R(e)},M=()=>h(),q=e=>{ie.confirm({title:"Confirm "+(e.is_locked?"Unlock":"Lock"),icon:e.is_locked?a(ne,{}):a(P,{}),content:e.is_locked?"This will ALLOW users to make modifications to the project. Are you sure you want to continue?":"This will PREVENT users to make modifications to the project. Are you sure you want to continue?",onOk:async()=>{try{const t=await(e.is_locked?I.unlock(e.uuid):I.lock(e.uuid));d.success({title:"Success",message:t.message}),h()}catch(t){d.error({title:"Error",message:t.response.data.message})}}})},[r,B]=n.exports.useState(null),G=e=>{m.resetFields(),B(e),_(!0)},$=async e=>{try{const t=await b.post(`/projects/${r==null?void 0:r.uuid}/drop`,e);d.success({message:O.SUCCESS_MESSAGE,description:t.data.message})}catch(t){d.error({message:O.ERROR_MESSAGE,description:t.response.data.message})}};return o(w,{children:[a(z,{title:o(w,{children:[a(K,{})," Tracker"]}),extra:o(x,{children:[a(ue,{onSearch:F,value:p}),o(C,{type:"primary",onClick:()=>S("/pips/create"),children:[a(H,{}),"New"]}),a(pe,{onClick:M})]})}),o(re,{children:[a(J,{rowKey:e=>e.uuid,loading:L,dataSource:v,columns:N,pagination:{...E,position:["bottomCenter"],onChange:j},tableLayout:"fixed",size:"small"}),o(Q,{open:D,destroyOnClose:!0,title:"Drop PAP",closable:!0,onClose:()=>_(!1),extra:a(C,{type:"primary",onClick:m.submit,children:"Submit"}),children:[o("h1",{children:["Title: ",r==null?void 0:r.title]}),a(k,{form:m,onFinish:$,initialValues:{remarks:""},layout:"vertical",children:a(k.Item,{label:"Please enter reason for dropping below:",name:"remarks",rules:[{required:!0,message:"This field is required."}],children:a(W.TextArea,{autoSize:{minRows:3},showCount:!0,maxLength:500,placeholder:"Indicate reason for dropping. This will be included in the notification that will be sent to the office."})})})]})]})]})};export{we as default};
