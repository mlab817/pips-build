import{r as o,ab as k,u as H,b as i,F as x,j as a,a1 as Q,x as W,S as C,B as P,an as J,a4 as X,D as Y,ad as Z,A as g,a6 as ee,aK as c,h as te,q as ae,M as se,aL as oe,aM as ne,aN as ie,aO as re,aP as O,V as le,aQ as ce,n as d}from"./vendor.c9756e39.js";import{b as de,I as ue,C as pe,a as f,P as I,e as T}from"./index.495bcaaa.js";import{O as me}from"./index.0cb5a3dd.js";import{U as he}from"./index.a5820840.js";import{T as ke}from"./table-search.component.6c28f8e5.js";import{R as ge}from"./download-button.component.6ccc7d74.js";import"./new-button.component.3ec819ff.js";const Pe=()=>{const[v,E]=o.exports.useState([]),[L,A]=o.exports.useState({}),[y,w]=o.exports.useState(1),[_,R]=o.exports.useState(10),[D,u]=o.exports.useState(!1),[p,U]=o.exports.useState(""),[N,S]=o.exports.useState(!1),[m]=k.useForm();de();const j=async t=>{console.log(t);try{const e=await f.get("/generate-pdf/"+t.uuid+"?download=true",{responseType:"blob"});window.open(URL.createObjectURL(e.data)),console.log(e)}catch(e){console.log(e)}},F=[{title:"Project Title",dataIndex:"title",key:"title"},{title:"Office",dataIndex:"office",key:"office_id",render:(t,e)=>{var s,n;return a(me,{office:e.office,children:a(g,{style:{backgroundColor:(s=e.office)==null?void 0:s.color},children:(n=e.office)==null?void 0:n.acronym})})},align:"center"},{title:"Issues",dataIndex:"issues_count",key:"issues_count",align:"center",render:(t,e)=>e.issues_count>0?e.issues_count:a(ee,{style:{color:pe.green}})},{title:"PIPS",dataIndex:"pips_status",key:"pips_status_id",render:(t,e)=>{var s,n,l;return a(c,{color:(s=e.pips_status)==null?void 0:s.color,children:(l=(n=e.pips_status)==null?void 0:n.name)==null?void 0:l.toUpperCase()})},align:"center"},{title:"Passed Validation",dataIndex:"passes_validation",key:"passes_validation",align:"center",render:t=>{switch(t){case 1:return a(c,{color:"green",children:"PASSED"});case-1:return a(c,{color:"red",children:"FAILED"});default:return a(c,{color:"geekblue",children:"PENDING"})}}},{title:"Overall Remarks",dataIndex:"remarks",key:"remarks",align:"center",render:(t,e)=>{var s;return(s=e.checklist)==null?void 0:s.overall_remarks}},{title:"PIPOL",dataIndex:"pipol_status",key:"pipol_status_id",render:(t,e)=>{var s,n,l;return a(c,{color:(s=e.pipol_status)==null?void 0:s.color,children:(l=(n=e.pipol_status)==null?void 0:n.name)==null?void 0:l.toUpperCase()})},align:"center"},{title:"Reviewers",dataIndex:"reviewers",key:"reviewers",render:t=>a(g.Group,{children:t.map((e,s)=>a(he,{user:e,children:a(g,{style:{backgroundColor:e.color},children:e.avatar})},s))}),align:"center"},{title:"Last Updated",dataIndex:"updated_at",key:"updated_at",render:t=>te(t).fromNow(),align:"center"},{title:"Actions",dataIndex:"actions",key:"actions",render:(t,e)=>a(C,{children:a(ae.Button,{overlay:a(se,{style:{width:150},items:[{label:"Edit",key:1,icon:a(oe,{}),onClick:()=>b(`/pips/${e.uuid}`),disabled:!e.permissions.view},{label:"Drop",key:2,icon:a(ne,{}),onClick:()=>$(e),disabled:!e.permissions.drop},{label:"Print",key:3,icon:a(ie,{}),onClick:()=>z(e)},{label:"Download",key:4,icon:a(re,{}),onClick:()=>j(e)},{type:"divider"},{label:"Lock",key:5,icon:a(O,{}),onClick:()=>G(e),disabled:!e.permissions.lock}]})})}),align:"center"}],b=H(),z=t=>{window.open(`/pips/${t.uuid}/print`,{target:"_blank"})},h=async()=>{u(!0);try{const t=await f.get("/tracker",{params:{page:y,q:p,per_page:_}});E(t.data.data),A(t.data.meta.pagination),u(!1)}catch(t){message.error(t.response.data.message),u(!1)}};o.exports.useEffect(()=>{h()},[y,p,_]);const M=({current:t,pageSize:e})=>{w(t),R(e)},q=t=>{w(1),U(t)},B=()=>h(),G=t=>{le.confirm({title:"Confirm "+(t.is_locked?"Unlock":"Lock"),icon:t.is_locked?a(ce,{}):a(O,{}),content:t.is_locked?"This will ALLOW users to make modifications to the project. Are you sure you want to continue?":"This will PREVENT users to make modifications to the project. Are you sure you want to continue?",onOk:async()=>{try{const e=await(t.is_locked?I.unlock(t.uuid):I.lock(t.uuid));d.success({title:"Success",message:e.message}),h()}catch(e){d.error({title:"Error",message:e.response.data.message})}}})},[r,V]=o.exports.useState(null),$=t=>{m.resetFields(),V(t),S(!0)},K=async t=>{try{const e=await f.post(`/projects/${r==null?void 0:r.uuid}/drop`,t);d.success({message:T.SUCCESS_MESSAGE,description:e.data.message})}catch(e){d.error({message:T.ERROR_MESSAGE,description:e.response.data.message})}};return i(x,{children:[a(Q,{title:i(x,{children:[a(W,{})," Tracker"]}),extra:i(C,{children:[a(ke,{onSearch:q,value:p}),i(P,{type:"primary",onClick:()=>b("/pips/create"),children:[a(J,{}),"New"]}),a(ge,{onClick:B})]})}),i(ue,{children:[a(X,{rowKey:t=>t.uuid,loading:D,dataSource:v,columns:F,pagination:{...L,position:["bottomCenter"],showSizeChanger:!0},onChange:M,tableLayout:"fixed",size:"small"}),i(Y,{open:N,destroyOnClose:!0,title:"Drop PAP",closable:!0,onClose:()=>S(!1),extra:a(P,{type:"primary",onClick:m.submit,children:"Submit"}),children:[i("h1",{children:["Title: ",r==null?void 0:r.title]}),a(k,{form:m,onFinish:K,initialValues:{remarks:""},layout:"vertical",children:a(k.Item,{label:"Please enter reason for dropping below:",name:"remarks",rules:[{required:!0,message:"This field is required."}],children:a(Z.TextArea,{autoSize:{minRows:3},showCount:!0,maxLength:500,placeholder:"Indicate reason for dropping. This will be included in the notification that will be sent to the office."})})})]})]})]})};export{Pe as default};
