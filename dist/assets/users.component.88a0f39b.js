import{h as D,d as q,S as F,U as O,a as ie,g as le,e as z,I as ce,R as de}from"./index.c2c60e57.js";import{ai as V,r,a9 as a,b as o,F as K,j as e,B as u,aJ as ue,D as P,n as d,S as W,e as T,au as b,ab as I,b1 as me,a2 as A,$ as pe,U as he,c as ge,al as fe,a_ as be,a$ as Se,b0 as ye,o as Ce,aP as M,m as xe,a7 as Ee,A as L,af as $,aj as Ie}from"./vendor.f6fa5c08.js";import{T as Oe}from"./table-search.component.fb71bfc0.js";import"./new-button.component.9cb43db0.js";import{O as Fe}from"./index.bb59335a.js";const B=({user:m})=>{const{loadData:S}=D(),[i,y]=r.exports.useState(!1),[p]=a.useForm(),[g,l]=r.exports.useState(!1),{uuid:C,first_name:x,office_id:h,roles:f}=m,{options:{offices:c,roles:n}}=q(),U=async _=>{l(!0);try{const E=await O.put(C,_);console.log(E),l(!1),d.success({message:"Success!",description:E.message}),S()}catch(E){console.error(E),d.error({message:"Error!",description:E.response.data.message}),l(!1)}};return o(K,{children:[e(u,{shape:"circle",icon:e(ue,{}),onClick:()=>y(!i)}),e(P,{title:`User: ${x}`,open:i,extra:e(u,{loading:g,type:"primary",htmlType:"submit",onClick:p.submit,children:"Submit"}),closable:!0,onClose:()=>y(!1),children:o(a,{form:p,onFinish:U,layout:"vertical",initialValues:{office_id:h,roles:[...f.map(({id:_})=>_)]},children:[e(a.Item,{label:"Office",name:"office_id",rules:[{required:!0,message:"This field is required"}],children:e(F,{options:c})}),e(a.Item,{label:"Roles",name:"roles",rules:[{required:!0,message:"This field is required"}],children:e(F,{options:n,mode:"multiple"})})]})})]})};B.propTypes={user:V.exports.object};const H=({onClose:m,visible:S})=>{const[i]=a.useForm(),[y,p]=r.exports.useState([]),[g,l]=r.exports.useState(!1),{loadData:C}=D(),{options:{offices:x,roles:h}}=q(),f=async c=>{l(!0);try{const n=await O.post(c);console.log(n),d.success({message:"Success!",description:n.message}),i.resetFields(),l(!1),C()}catch(n){d.error({message:"Error",description:n.response.data.message}),l(!1)}};return r.exports.useEffect(()=>{(async()=>{try{const n=await ie.get("/colors");p(n.data)}catch{}})()},[]),e(P,{title:"New User",open:S,onClose:m,forceRender:!0,width:720,extra:e(W,{children:e(u,{onClick:i.submit,type:"primary",loading:g,children:"Submit"})}),children:o(a,{form:i,layout:"vertical",initialValues:{username:"",first_name:"",last_name:"",position:"",office_id:"",email:"",contact_number:"",roles:[]},onFinish:f,children:[o(T,{gutter:16,children:[e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Username",name:"username",rules:[{required:!0}],children:e(I,{prefix:"@"})})}),e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Roles",name:"roles",rules:[{required:!0}],children:e(F,{options:h,mode:"multiple"})})})]}),o(T,{gutter:16,children:[e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"First Name",name:"first_name",rules:[{required:!0}],children:e(I,{})})}),e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Last Name",name:"last_name",rules:[{required:!0}],children:e(I,{})})})]}),o(T,{gutter:16,children:[e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Office",name:"office_id",rules:[{required:!0}],children:e(F,{options:x})})}),e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Position",name:"position",rules:[{required:!0}],children:e(I,{})})})]}),o(T,{gutter:16,children:[e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Email Address",name:"email",rules:[{required:!0}],children:e(I,{})})}),e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Contact Number",name:"contact_number",rules:[{required:!0}],children:e(I,{})})})]})]})})};H.propTypes={onClose:V.exports.func,visible:V.exports.bool};const G=({user:m})=>{var h,f;const[S,i]=r.exports.useState(!1),[y,p]=r.exports.useState(!1),[g]=a.useForm(),{loadData:l}=le(),{options:{offices:C}}=q(),x=async c=>{p(!0);try{const n=await O.assignOffices(m.uuid,c);d.success({message:z.SUCCESS_MESSAGE,description:n.message}),p(!1),l()}catch(n){d.success({message:z.ERROR_MESSAGE,description:n.response.data.message}),p(!1)}};return o(K,{children:[e(u,{icon:e(me,{}),shape:"circle",onClick:()=>i(!0)}),e(P,{title:`Assign Offices: ${m.fullname}`,open:S,closable:!0,onClose:()=>i(!1),extra:e(u,{"aria-label":"open",loading:y,type:"primary",onClick:g.submit,children:"Submit"}),children:e(a,{form:g,onFinish:x,layout:"vertical",initialValues:{offices:(f=(h=m.reviews)==null?void 0:h.map(({id:c})=>c))!=null?f:[]},children:e(a.Item,{name:"offices",label:"Offices",children:e(F,{options:C,mode:"multiple"})})})})]})},qe=()=>{const[m,S]=r.exports.useState(1),[i,y]=r.exports.useState(10),[p,g]=r.exports.useState(!1),[l,C]=r.exports.useState(""),[x,h]=r.exports.useState(!1),[f,c]=r.exports.useState(!1),[n]=a.useForm(),{state:{data:U,pagination:_,loading:E},loadData:j}=D(),{options:{roles:J}}=q();r.exports.useEffect(()=>{k()},[m,l,i]);const Q=({current:t,pageSize:s})=>{S(t),y(s)},X=t=>C(t),Y=()=>g(!1),Z=async({uuid:t})=>{try{const s=await O.delete(t);k(),d.success({message:"Success!",description:s.message})}catch(s){console.error(s),d.error({message:"Error!",description:s.response.data.message})}},ee=async({uuid:t})=>{try{const s=await O.resendWelcomeEmail(t);d.success({message:"Success!",description:s.message}),k()}catch(s){d.error({message:"Error!",description:s.response.data.message})}},k=()=>{j(m,l,i),N([])},[R,N]=r.exports.useState([]),se={selectedRowKeys:R,onChange:t=>{console.log("selectedRowKeys changed: ",R),N(t)},selections:[A.SELECTION_ALL,A.SELECTION_INVERT,A.SELECTION_NONE]},te=[{title:"Full Name / Position",dataIndex:"fullname",key:"fullname",render:(t,s)=>o("span",{children:[s.last_name+", "+s.first_name,e("br",{}),e("small",{children:s.position})]})},{title:"Email",dataIndex:"email",key:"email",render:t=>e(Ce,{title:t,children:e(M,{onClick:()=>{xe.success("Copied email!"),Ee(t)}})}),align:"center"},{title:"Username",dataIndex:"username",key:"username",align:"center"},{title:"Office",dataIndex:"office",key:"office",render:(t,{office:s})=>e(L,{style:{backgroundColor:s==null?void 0:s.color},children:s==null?void 0:s.acronym}),align:"center"},{title:"Roles",dataIndex:"roles",key:"roles",render:(t,{roles:s})=>s==null?void 0:s.map(w=>w.name).join(", "),align:"center"},{title:"For Review",dataIndex:"reviews",key:"reviews",align:"center",render:(t,s)=>{var w;return t.length?o(L.Group,{maxCount:2,children:[e(G,{user:s}),t.map((v,oe)=>e(Fe,{office:v,children:e(L,{style:{backgroundColor:v.color},children:v.acronym})},oe))]}):((w=s.all_roles)==null?void 0:w.includes(de.PIP_REVIEWER))&&e(G,{user:s})}},{title:"Actions",dataIndex:"actions",key:"actions",align:"center",render:(t,s)=>o(W,{children:[e(B,{user:s}),e($,{title:"Are you sure you want to delete this user?",onConfirm:()=>Z(s),placement:"topRight",children:e(u,{icon:e(Ie,{}),danger:!0,shape:"circle"})}),e($,{disabled:s.welcome_sent,title:"Are you sure you want to resend welcome email to user? This will reset their password.",onConfirm:()=>ee(s),placement:"topRight",children:e(u,{disabled:s.welcome_sent,icon:e(M,{}),shape:"circle"})})]})}],ae=async t=>{c(!0);try{const s=await O.assignRoles({...t,users:R});c(!1),j(),d.success({message:"Success!",description:s.message}),N([]),h(!1)}catch(s){c(!1),d.error({message:"Error!",description:s.response.data.message})}},[re,ne]=r.exports.useState("small");return o(r.exports.Fragment,{children:[e(pe,{title:o("span",{children:[e(he,{})," Users"]}),extra:o(r.exports.Fragment,{children:[R.length>0&&e(u,{onClick:()=>h(!0),children:"Assign Role"}),e(Oe,{onSearch:X}),e(u,{icon:e(ge,{}),onClick:k}),o(u,{type:"primary",onClick:()=>g(!0),children:[e(fe,{}),"New"]}),e(be,{options:[{value:"small",icon:e(Se,{})},{value:"middle",icon:e(ye,{})}],onChange:t=>ne(t)})]})}),o(ce,{children:[e(A,{rowSelection:se,loading:E,dataSource:U,pagination:{..._,position:["bottomCenter"]},onChange:Q,columns:te,tableLayout:"fixed",size:re}),e(H,{visible:p,onClose:Y}),e(P,{open:x,title:"Assign Roles",extra:e(u,{loading:f,type:"primary",onClick:n.submit,children:"Submit"}),onClose:()=>h(!1),children:e(a,{form:n,layout:"vertical",onFinish:ae,initialValues:[{roles:[]}],children:e(a.Item,{label:"Roles",name:"roles",rules:[{required:!0,message:"This field is required"}],children:e(F,{options:J,mode:"multiple"})})})})]})]})};export{qe as default};
