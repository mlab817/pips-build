import{u as A,j as t,a4 as q,A as g,b as d,aK as v,a6 as G,h as K,q as j,M as B,aL as Q,al as Y,aN as J,a_ as D,o as X,V as Z,n as T,r as i,a1 as ee,F as te,w as ae,a$ as ne,b0 as oe,b1 as se,b2 as le,B as re,as as ie,Q as de,m as ce}from"./vendor.876bea49.js";import{T as me}from"./table-search.component.0d2a4746.js";import{c as F,d as ge,C as E,P as ue,b as he,u as L,R as ye,I as pe,a as ke}from"./index.8d680bcc.js";import{D as be,R as we}from"./download-button.component.e8a689a9.js";import{N as Pe}from"./new-button.component.c0c9d783.js";import{U as R}from"./index.003afbdf.js";import{O as fe}from"./index.fa7eac3d.js";const Ce=({data:o,pagination:c,loading:u,onChange:h,size:m})=>{const y=A(),{loadData:p}=F(),k=async({uuid:e})=>{Z.confirm({title:"Are you sure you want to delete this project?",onOk:async()=>{try{const a=await ue.delete(e);T.success({message:"Success",description:a.message}),p()}catch(a){T.error({message:"Error",description:a.response.data.message})}}})},s=e=>y(`/pips/${e.uuid}`);return ge(),t(q,{loading:u,dataSource:o,pagination:c,columns:[{title:"Office",dataIndex:"office",key:"office",render:e=>e&&t(fe,{office:e,children:t(g,{style:{backgroundColor:e.color},children:e.acronym})}),align:"center",width:"5%",filterSearch:!0},{title:"Title",dataIndex:"title",key:"title",width:"40%"},{title:"Issues/ Comments",dataIndex:"comments_count",key:"comments_count",align:"center",render:(e,a)=>a.issues+" / "+a.comments},{title:"PIPS Status",dataIndex:"pips_status",key:"pips_status",render:e=>{var a;return d(v,{color:e==null?void 0:e.color,children:[(a=e==null?void 0:e.name)==null?void 0:a.toLowerCase()," "]})},align:"center"},{title:"Validated?",dataIndex:"passes_validation",key:"passes_validation",render:e=>e?t(G,{style:{color:E.green}}):"",align:"center"},{title:"PIPOL Status",dataIndex:"pipol_status",key:"pipol_status",render:e=>{var a;return t(v,{color:e==null?void 0:e.color,children:(a=e==null?void 0:e.name)==null?void 0:a.toLowerCase()})},align:"center"},{title:"Last Updated",dataIndex:"updated_at",key:"updated_at",render:e=>K(e).fromNow(),align:"center"},{title:"Added by",dataIndex:"user",key:"user",render:e=>t(R,{user:e,children:t(g,{style:{backgroundColor:e.color},children:e.avatar})}),align:"center"},{title:"Reviewers",dataIndex:"reviewers",key:"reviewers",align:"center",render:(e,a)=>{var l;return t(g.Group,{children:(l=a.reviewers)==null?void 0:l.map((r,b)=>t(R,{user:r,children:t(g,{style:{backgroundColor:r.color},children:r.avatar})},b))})}},{title:"Actions",key:"actions",render:(e,a)=>t(j.Button,{overlay:t(B,{style:{width:150},items:[{label:"Edit",key:1,icon:t(Q,{}),onClick:()=>s(a),disabled:!a.permissions.update},{label:"Delete",key:2,icon:t(Y,{}),onClick:()=>k(a),disabled:!a.permissions.delete},{label:"Print",key:3,icon:t(J,{}),onClick:()=>window.open(`/pips/${a.uuid}/print`)}]})}),align:"center"},{title:t(D,{}),dataIndex:"is_locked",key:"is_locked",render:e=>e&&t(X,{title:"Project is locked and cannot be modified",placement:"topRight",children:t(D,{style:{color:E.red}})})}],onChange:h,style:{marginBottom:16},size:m})},Ie="Programs and projects where the user's office is tagged as owner/encoder will appear here. For any issue/concern, please contact IPD.",Se=()=>alert(Ie),Re=()=>{var x,O;const{state:{currentUser:o}}=he(),{state:{data:c,pagination:u,loading:h},setPage:m,setPageSize:y,page:p,pageSize:k,sort:s,setSort:C,search:e,setSearch:a,loadData:l}=F(),r=({current:n,pageSize:P})=>{m(n),y(P)},b=A(),_=n=>{m(1),a(n)},[N,w]=i.exports.useState(!1),I=n=>C(n.key),U=()=>b("/pips/create");L();const S=[{label:"Office",key:"office_id"},{label:"Title",key:"title"},{label:"PIPS Status",key:"pips_status_id"},{label:"PIPOL Status",key:"pipol_status_id"},{label:"Added by",key:"user_id"},{label:"Last Updated",key:"updated_at"}],z=t(B,{style:{minWidth:120},onClick:I,items:S}),M=async()=>{w(!0);try{const n=await ke.get("/download",{responseType:"blob"});console.log(n);const P=n.headers["content-type"],W=new Blob([n.data],{type:P,encoding:"UTF-8"}),f=document.createElement("a");f.href=window.URL.createObjectURL(W),f.download=new Date().getTime()+"_projects.xlsx",f.click(),w(!1)}catch(n){console.log(n.message),ce.error(n.response.data.message),w(!1)}},{hasPassed:V}=L();i.exports.useEffect(()=>{l()},[p,k,e,s]);const[H,$]=i.exports.useState("small");return d(i.exports.Fragment,{children:[t(ee,{title:d(te,{children:[t(ae,{})," PIP/TRIP"]}),extra:d(i.exports.Fragment,{children:[t(me,{value:e,onSearch:_}),t(j.Button,{overlay:z,onClick:I,trigger:"click",icon:t(ne,{}),children:(x=s&&S.find(n=>n.key===s).label)!=null?x:"Sort"}),t(be,{onClick:M,loading:N,disabled:!c.length}),t(we,{onClick:()=>l()}),((O=o==null?void 0:o.all_roles)==null?void 0:O.includes(ye.PIP_ENCODER))&&t(Pe,{onClick:U}),t(oe,{options:[{value:"small",icon:t(se,{})},{value:"middle",icon:t(le,{})}],onChange:n=>$(n)}),t(re,{type:"text",icon:t(ie,{}),onClick:Se})]})}),d(pe,{children:[V&&t(de,{type:"error",showIcon:!0,message:"The deadline has passed. Only REVIEWERS can update PAP. You can monitor progress of review instead.",style:{marginBottom:16}}),t(Ce,{data:c,onChange:r,pagination:{...u,position:["bottomCenter"]},loading:h,size:H})]})]})};export{Re as default};
