import{r as i,a9 as k,u as K,b as o,F as x,j as a,$ as H,x as J,S as C,B as P,al as Q,a2 as W,D as X,ab as Y,A as g,a4 as Z,aI as c,h as ee,q as te,M as ae,aJ as se,aK as ie,aL as ne,aM as b,Q as oe,aN as re,n as d}from"./vendor.4b18af18.js";import{b as le,I as ce,C as de,a as I,P as O,e as v}from"./index.08dd6703.js";import{O as ue}from"./index.215efa2c.js";import{U as pe}from"./index.cdd2dec0.js";import{T as me}from"./table-search.component.e0d14365.js";import{R as he}from"./download-button.component.e0598ee2.js";import"./new-button.component.3f7c8e4c.js";const Ce=()=>{const[T,E]=i.exports.useState([]),[A,L]=i.exports.useState({}),[f,y]=i.exports.useState(1),[_,R]=i.exports.useState(10),[D,u]=i.exports.useState(!1),[p,N]=i.exports.useState(""),[U,S]=i.exports.useState(!1),[m]=k.useForm();le();const j=[{title:"Project Title",dataIndex:"title",key:"title"},{title:"Office",dataIndex:"office",key:"office_id",render:(t,e)=>{var s,n;return a(ue,{office:e.office,children:a(g,{style:{backgroundColor:(s=e.office)==null?void 0:s.color},children:(n=e.office)==null?void 0:n.acronym})})},align:"center"},{title:"Issues",dataIndex:"issues_count",key:"issues_count",align:"center",render:(t,e)=>e.issues_count>0?e.issues_count:a(Z,{style:{color:de.green}})},{title:"PIPS",dataIndex:"pips_status",key:"pips_status_id",render:(t,e)=>{var s,n,l;return a(c,{color:(s=e.pips_status)==null?void 0:s.color,children:(l=(n=e.pips_status)==null?void 0:n.name)==null?void 0:l.toUpperCase()})},align:"center"},{title:"Passed Validation",dataIndex:"passes_validation",key:"passes_validation",align:"center",render:t=>{switch(t){case 1:return a(c,{color:"green",children:"PASSED"});case-1:return a(c,{color:"red",children:"FAILED"});default:return a(c,{color:"geekblue",children:"PENDING"})}}},{title:"Overall Remarks",dataIndex:"remarks",key:"remarks",align:"center",render:(t,e)=>{var s;return(s=e.checklist)==null?void 0:s.overall_remarks}},{title:"PIPOL",dataIndex:"pipol_status",key:"pipol_status_id",render:(t,e)=>{var s,n,l;return a(c,{color:(s=e.pipol_status)==null?void 0:s.color,children:(l=(n=e.pipol_status)==null?void 0:n.name)==null?void 0:l.toUpperCase()})},align:"center"},{title:"Reviewers",dataIndex:"reviewers",key:"reviewers",render:t=>a(g.Group,{children:t.map((e,s)=>a(pe,{user:e,children:a(g,{style:{backgroundColor:e.color},children:e.avatar})},s))}),align:"center"},{title:"Last Updated",dataIndex:"updated_at",key:"updated_at",render:t=>ee(t).fromNow(),align:"center"},{title:"Actions",dataIndex:"actions",key:"actions",render:(t,e)=>a(C,{children:a(te.Button,{overlay:a(ae,{style:{width:150},items:[{label:"Edit",key:1,icon:a(se,{}),onClick:()=>w(`/pips/${e.uuid}`),disabled:!e.permissions.view},{label:"Drop",key:2,icon:a(ie,{}),onClick:()=>$(e),disabled:!e.permissions.drop},{label:"Print",key:3,icon:a(ne,{}),onClick:()=>z(e)},{type:"divider"},{label:"Lock",key:4,icon:a(b,{}),onClick:()=>B(e),disabled:!e.permissions.lock}]})})}),align:"center"}],w=K(),z=t=>{window.open(`/pips/${t.uuid}/print`,{target:"_blank"})},h=async()=>{u(!0);try{const t=await I.get("/tracker",{params:{page:f,q:p,per_page:_}});E(t.data.data),L(t.data.meta.pagination),u(!1)}catch(t){message.error(t.response.data.message),u(!1)}};i.exports.useEffect(()=>{h()},[f,p,_]);const F=({current:t,pageSize:e})=>{y(t),R(e)},M=t=>{y(1),N(t)},q=()=>h(),B=t=>{oe.confirm({title:"Confirm "+(t.is_locked?"Unlock":"Lock"),icon:t.is_locked?a(re,{}):a(b,{}),content:t.is_locked?"This will ALLOW users to make modifications to the project. Are you sure you want to continue?":"This will PREVENT users to make modifications to the project. Are you sure you want to continue?",onOk:async()=>{try{const e=await(t.is_locked?O.unlock(t.uuid):O.lock(t.uuid));d.success({title:"Success",message:e.message}),h()}catch(e){d.error({title:"Error",message:e.response.data.message})}}})},[r,G]=i.exports.useState(null),$=t=>{m.resetFields(),G(t),S(!0)},V=async t=>{try{const e=await I.post(`/projects/${r==null?void 0:r.uuid}/drop`,t);d.success({message:v.SUCCESS_MESSAGE,description:e.data.message})}catch(e){d.error({message:v.ERROR_MESSAGE,description:e.response.data.message})}};return o(x,{children:[a(H,{title:o(x,{children:[a(J,{})," Tracker"]}),extra:o(C,{children:[a(me,{onSearch:M,value:p}),o(P,{type:"primary",onClick:()=>w("/pips/create"),children:[a(Q,{}),"New"]}),a(he,{onClick:q})]})}),o(ce,{children:[a(W,{rowKey:t=>t.uuid,loading:D,dataSource:T,columns:j,pagination:{...A,position:["bottomCenter"],showSizeChanger:!0},onChange:F,tableLayout:"fixed",size:"small"}),o(X,{open:U,destroyOnClose:!0,title:"Drop PAP",closable:!0,onClose:()=>S(!1),extra:a(P,{type:"primary",onClick:m.submit,children:"Submit"}),children:[o("h1",{children:["Title: ",r==null?void 0:r.title]}),a(k,{form:m,onFinish:V,initialValues:{remarks:""},layout:"vertical",children:a(k.Item,{label:"Please enter reason for dropping below:",name:"remarks",rules:[{required:!0,message:"This field is required."}],children:a(Y.TextArea,{autoSize:{minRows:3},showCount:!0,maxLength:500,placeholder:"Indicate reason for dropping. This will be included in the notification that will be sent to the office."})})})]})]})]})};export{Ce as default};
