import{u as A,j as t,a4 as G,A as u,b as i,aK as T,a6 as K,h as Q,q as B,M as F,aL as Y,al as Z,aN as J,aZ as D,o as X,V as ee,n as L,r,a1 as te,F as ae,w as ne,a_ as oe,a$ as se,b0 as le,b1 as re,B as ie,as as de,Q as ce,m as ge}from"./vendor.c9756e39.js";import{T as me}from"./table-search.component.6c28f8e5.js";import{c as _,d as ue,C as R,a as U,P as he,b as ye,u as E,R as pe,I as ke}from"./index.1e3ba65c.js";import{D as we,R as be}from"./download-button.component.6ccc7d74.js";import{N as Pe}from"./new-button.component.a035c20d.js";import{U as j}from"./index.a5820840.js";import{O as fe}from"./index.0cb5a3dd.js";const Ce=({data:o,pagination:d,loading:h,onChange:y,size:c})=>{const p=A(),{loadData:k}=_(),w=async({uuid:e})=>{ee.confirm({title:"Are you sure you want to delete this project?",onOk:async()=>{try{const a=await he.delete(e);L.success({message:"Success",description:a.message}),k()}catch(a){L.error({message:"Error",description:a.response.data.message})}}})},s=e=>p(`/pips/${e.uuid}`);ue();const b=[{title:"Office",dataIndex:"office",key:"office",render:e=>e&&t(fe,{office:e,children:t(u,{style:{backgroundColor:e.color},children:e.acronym})}),align:"center",width:"5%",filterSearch:!0},{title:"Title",dataIndex:"title",key:"title",width:"40%"},{title:"Issues/ Comments",dataIndex:"comments_count",key:"comments_count",align:"center",render:(e,a)=>a.issues+" / "+a.comments},{title:"PIPS Status",dataIndex:"pips_status",key:"pips_status",render:e=>{var a;return i(T,{color:e==null?void 0:e.color,children:[(a=e==null?void 0:e.name)==null?void 0:a.toLowerCase()," "]})},align:"center"},{title:"Validated?",dataIndex:"passes_validation",key:"passes_validation",render:e=>e?t(K,{style:{color:R.green}}):"",align:"center"},{title:"PIPOL Status",dataIndex:"pipol_status",key:"pipol_status",render:e=>{var a;return t(T,{color:e==null?void 0:e.color,children:(a=e==null?void 0:e.name)==null?void 0:a.toLowerCase()})},align:"center"},{title:"Last Updated",dataIndex:"updated_at",key:"updated_at",render:e=>Q(e).fromNow(),align:"center"},{title:"Added by",dataIndex:"user",key:"user",render:e=>t(j,{user:e,children:t(u,{style:{backgroundColor:e.color},children:e.avatar})}),align:"center"},{title:"Reviewers",dataIndex:"reviewers",key:"reviewers",align:"center",render:(e,a)=>{var m;return t(u.Group,{children:(m=a.reviewers)==null?void 0:m.map((l,P)=>t(j,{user:l,children:t(u,{style:{backgroundColor:l.color},children:l.avatar})},P))})}},{title:"Actions",key:"actions",render:(e,a)=>t(B.Button,{overlay:t(F,{style:{width:150},items:[{label:"Edit",key:1,icon:t(Y,{}),onClick:()=>s(a),disabled:!a.permissions.update},{label:"Delete",key:2,icon:t(Z,{}),onClick:()=>w(a),disabled:!a.permissions.delete},{label:"Print",key:3,icon:t(J,{}),onClick:()=>g(a)}]})}),align:"center"},{title:t(D,{}),dataIndex:"is_locked",key:"is_locked",render:e=>e&&t(X,{title:"Project is locked and cannot be modified",placement:"topRight",children:t(D,{style:{color:R.red}})})}],g=async e=>{console.log(e);try{const a=await U.get("/generate-pdf/"+e.uuid+"?download=true",{responseType:"blob"});window.open(URL.createObjectURL(a.data)),console.log(a)}catch(a){console.log(a)}};return t(G,{loading:h,dataSource:o,pagination:d,columns:b,onChange:y,style:{marginBottom:16},size:c})},Ie="Programs and projects where the user's office is tagged as owner/encoder will appear here. For any issue/concern, please contact IPD.",Se=()=>alert(Ie),Ee=()=>{var x,v;const{state:{currentUser:o}}=ye(),{state:{data:d,pagination:h,loading:y},setPage:c,setPageSize:p,page:k,pageSize:w,sort:s,setSort:b,search:g,setSearch:e,loadData:a}=_(),m=({current:n,pageSize:C})=>{c(n),p(C)},l=A(),P=n=>{c(1),e(n)},[N,f]=r.exports.useState(!1),S=n=>b(n.key),z=()=>l("/pips/create");E();const O=[{label:"Office",key:"office_id"},{label:"Title",key:"title"},{label:"PIPS Status",key:"pips_status_id"},{label:"PIPOL Status",key:"pipol_status_id"},{label:"Added by",key:"user_id"},{label:"Last Updated",key:"updated_at"}],M=t(F,{style:{minWidth:120},onClick:S,items:O}),V=async()=>{f(!0);try{const n=await U.get("/download",{responseType:"blob"});console.log(n);const C=n.headers["content-type"],q=new Blob([n.data],{type:C,encoding:"UTF-8"}),I=document.createElement("a");I.href=window.URL.createObjectURL(q),I.download=new Date().getTime()+"_projects.xlsx",I.click(),f(!1)}catch(n){console.log(n.message),ge.error(n.response.data.message),f(!1)}},{hasPassed:H}=E();r.exports.useEffect(()=>{a()},[k,w,g,s]);const[W,$]=r.exports.useState("small");return i(r.exports.Fragment,{children:[t(te,{title:i(ae,{children:[t(ne,{})," PIP/TRIP"]}),extra:i(r.exports.Fragment,{children:[t(me,{value:g,onSearch:P}),t(B.Button,{overlay:M,onClick:S,trigger:"click",icon:t(oe,{}),children:(x=s&&O.find(n=>n.key===s).label)!=null?x:"Sort"}),t(we,{onClick:V,loading:N,disabled:!d.length}),t(be,{onClick:()=>a()}),((v=o==null?void 0:o.all_roles)==null?void 0:v.includes(pe.PIP_ENCODER))&&t(Pe,{onClick:z}),t(se,{options:[{value:"small",icon:t(le,{})},{value:"middle",icon:t(re,{})}],onChange:n=>$(n)}),t(ie,{type:"text",icon:t(de,{}),onClick:Se})]})}),i(ke,{children:[H&&t(ce,{type:"error",showIcon:!0,message:"The deadline has passed. Only REVIEWERS can update PAP. You can monitor progress of review instead.",style:{marginBottom:16}}),t(Ce,{data:d,onChange:m,pagination:{...h,position:["bottomCenter"]},loading:y,size:W})]})]})};export{Ee as default};
