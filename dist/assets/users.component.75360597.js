import{h as D,d as q,S as O,U as F,a as ie,g as le,e as z,I as ce,R as de}from"./index.7dcb18bf.js";import{ai as V,r,a9 as a,b as o,F as G,j as e,B as h,aJ as ue,D as N,n as d,S as K,e as T,au as b,ab as I,b0 as me,a2 as A,$ as pe,U as he,c as ge,aZ as fe,a_ as be,a$ as Se,o as ye,aP as M,m as Ce,a7 as xe,A as L,af as $,aj as Ee}from"./vendor.717f8fec.js";import{T as Ie}from"./table-search.component.ce6b9b32.js";import{N as Fe}from"./new-button.component.9f247388.js";import{O as Oe}from"./index.d2755a32.js";const W=({user:u})=>{const{loadData:S}=D(),[i,y]=r.exports.useState(!1),[m]=a.useForm(),[g,l]=r.exports.useState(!1),{uuid:C,first_name:x,office_id:p,roles:f}=u,{options:{offices:c,roles:n}}=q(),U=async _=>{l(!0);try{const E=await F.put(C,_);console.log(E),l(!1),d.success({message:"Success!",description:E.message}),S()}catch(E){console.error(E),d.error({message:"Error!",description:E.response.data.message}),l(!1)}};return o(G,{children:[e(h,{shape:"circle",icon:e(ue,{}),onClick:()=>y(!i)}),e(N,{title:`User: ${x}`,open:i,extra:e(h,{loading:g,type:"primary",htmlType:"submit",onClick:m.submit,children:"Submit"}),closable:!0,onClose:()=>y(!1),children:o(a,{form:m,onFinish:U,layout:"vertical",initialValues:{office_id:p,roles:[...f.map(({id:_})=>_)]},children:[e(a.Item,{label:"Office",name:"office_id",rules:[{required:!0,message:"This field is required"}],children:e(O,{options:c})}),e(a.Item,{label:"Roles",name:"roles",rules:[{required:!0,message:"This field is required"}],children:e(O,{options:n,mode:"multiple"})})]})})]})};W.propTypes={user:V.exports.object};const H=({onClose:u,visible:S})=>{const[i]=a.useForm(),[y,m]=r.exports.useState([]),[g,l]=r.exports.useState(!1),{loadData:C}=D(),{options:{offices:x,roles:p}}=q(),f=async c=>{l(!0);try{const n=await F.post(c);console.log(n),d.success({message:"Success!",description:n.message}),i.resetFields(),l(!1),C()}catch(n){d.error({message:"Error",description:n.response.data.message}),l(!1)}};return r.exports.useEffect(()=>{(async()=>{try{const n=await ie.get("/colors");m(n.data)}catch{}})()},[]),e(N,{title:"New User",open:S,onClose:u,forceRender:!0,width:720,extra:e(K,{children:e(h,{onClick:i.submit,type:"primary",loading:g,children:"Submit"})}),children:o(a,{form:i,layout:"vertical",initialValues:{username:"",first_name:"",last_name:"",position:"",office_id:"",email:"",contact_number:"",roles:[]},onFinish:f,children:[o(T,{gutter:16,children:[e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Username",name:"username",rules:[{required:!0}],children:e(I,{prefix:"@"})})}),e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Roles",name:"roles",rules:[{required:!0}],children:e(O,{options:p,mode:"multiple"})})})]}),o(T,{gutter:16,children:[e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"First Name",name:"first_name",rules:[{required:!0}],children:e(I,{})})}),e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Last Name",name:"last_name",rules:[{required:!0}],children:e(I,{})})})]}),o(T,{gutter:16,children:[e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Office",name:"office_id",rules:[{required:!0}],children:e(O,{options:x})})}),e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Position",name:"position",rules:[{required:!0}],children:e(I,{})})})]}),o(T,{gutter:16,children:[e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Email Address",name:"email",rules:[{required:!0}],children:e(I,{})})}),e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Contact Number",name:"contact_number",rules:[{required:!0}],children:e(I,{})})})]})]})})};H.propTypes={onClose:V.exports.func,visible:V.exports.bool};const B=({user:u})=>{var p,f;const[S,i]=r.exports.useState(!1),[y,m]=r.exports.useState(!1),[g]=a.useForm(),{loadData:l}=le(),{options:{offices:C}}=q(),x=async c=>{m(!0);try{const n=await F.assignOffices(u.uuid,c);d.success({message:z.SUCCESS_MESSAGE,description:n.message}),m(!1),l()}catch(n){d.success({message:z.ERROR_MESSAGE,description:n.response.data.message}),m(!1)}};return o(G,{children:[e(h,{icon:e(me,{}),shape:"circle",onClick:()=>i(!0)}),e(N,{title:`Assign Offices: ${u.fullname}`,open:S,closable:!0,onClose:()=>i(!1),extra:e(h,{"aria-label":"open",loading:y,type:"primary",onClick:g.submit,children:"Submit"}),children:e(a,{form:g,onFinish:x,layout:"vertical",initialValues:{offices:(f=(p=u.reviews)==null?void 0:p.map(({id:c})=>c))!=null?f:[]},children:e(a.Item,{name:"offices",label:"Offices",children:e(O,{options:C,mode:"multiple"})})})})]})},qe=()=>{const[u,S]=r.exports.useState(1),[i,y]=r.exports.useState(10),[m,g]=r.exports.useState(!1),[l,C]=r.exports.useState(""),[x,p]=r.exports.useState(!1),[f,c]=r.exports.useState(!1),[n]=a.useForm(),{state:{data:U,pagination:_,loading:E},loadData:j}=D(),{options:{roles:J}}=q();r.exports.useEffect(()=>{k()},[u,l,i]);const Z=({current:t,pageSize:s})=>{S(t),y(s)},Q=t=>C(t),X=()=>g(!1),Y=async({uuid:t})=>{try{const s=await F.delete(t);k(),d.success({message:"Success!",description:s.message})}catch(s){console.error(s),d.error({message:"Error!",description:s.response.data.message})}},ee=async({uuid:t})=>{try{const s=await F.resendWelcomeEmail(t);d.success({message:"Success!",description:s.message}),k()}catch(s){d.error({message:"Error!",description:s.response.data.message})}},k=()=>{j(u,l,i),P([])},[R,P]=r.exports.useState([]),se={selectedRowKeys:R,onChange:t=>{console.log("selectedRowKeys changed: ",R),P(t)},selections:[A.SELECTION_ALL,A.SELECTION_INVERT,A.SELECTION_NONE]},te=[{title:"Full Name / Position",dataIndex:"fullname",key:"fullname",render:(t,s)=>o("span",{children:[s.last_name+", "+s.first_name,e("br",{}),e("small",{children:s.position})]})},{title:"Email",dataIndex:"email",key:"email",render:t=>e(ye,{title:t,children:e(M,{onClick:()=>{Ce.success("Copied email!"),xe(t)}})}),align:"center"},{title:"Username",dataIndex:"username",key:"username",align:"center"},{title:"Office",dataIndex:"office",key:"office",render:(t,{office:s})=>e(L,{style:{backgroundColor:s==null?void 0:s.color},children:s==null?void 0:s.acronym}),align:"center"},{title:"Roles",dataIndex:"roles",key:"roles",render:(t,{roles:s})=>s==null?void 0:s.map(w=>w.name).join(", "),align:"center"},{title:"For Review",dataIndex:"reviews",key:"reviews",align:"center",render:(t,s)=>{var w;return t.length?o(L.Group,{maxCount:2,children:[e(B,{user:s}),t.map((v,oe)=>e(Oe,{office:v,children:e(L,{style:{backgroundColor:v.color},children:v.acronym})},oe))]}):((w=s.all_roles)==null?void 0:w.includes(de.PIP_REVIEWER))&&e(B,{user:s})}},{title:"Actions",dataIndex:"actions",key:"actions",align:"center",render:(t,s)=>o(K,{children:[e(W,{user:s}),e($,{title:"Are you sure you want to delete this user?",onConfirm:()=>Y(s),placement:"topRight",children:e(h,{icon:e(Ee,{}),danger:!0,shape:"circle"})}),e($,{disabled:s.welcome_sent,title:"Are you sure you want to resend welcome email to user? This will reset their password.",onConfirm:()=>ee(s),placement:"topRight",children:e(h,{disabled:s.welcome_sent,icon:e(M,{}),shape:"circle"})})]})}],ae=async t=>{c(!0);try{const s=await F.assignRoles({...t,users:R});c(!1),j(),d.success({message:"Success!",description:s.message}),P([]),p(!1)}catch(s){c(!1),d.error({message:"Error!",description:s.response.data.message})}},[re,ne]=r.exports.useState("small");return o(r.exports.Fragment,{children:[e(pe,{title:o("span",{children:[e(he,{})," Users"]}),extra:o(r.exports.Fragment,{children:[R.length>0&&e(h,{onClick:()=>p(!0),children:"Assign Role"}),e(Ie,{onSearch:Q}),e(h,{icon:e(ge,{}),onClick:k}),e(Fe,{onClick:()=>g(!0)}),e(fe,{options:[{value:"small",icon:e(be,{})},{value:"middle",icon:e(Se,{})}],onChange:t=>ne(t)})]})}),o(ce,{children:[e(A,{rowSelection:se,loading:E,dataSource:U,pagination:{..._,position:["bottomCenter"]},onChange:Z,columns:te,tableLayout:"fixed",size:re}),e(H,{visible:m,onClose:X}),e(N,{open:x,title:"Assign Roles",extra:e(h,{loading:f,type:"primary",onClick:n.submit,children:"Submit"}),onClose:()=>p(!1),children:e(a,{form:n,layout:"vertical",onFinish:ae,initialValues:[{roles:[]}],children:e(a.Item,{label:"Roles",name:"roles",rules:[{required:!0,message:"This field is required"}],children:e(O,{options:J,mode:"multiple"})})})})]})]})};export{qe as default};
