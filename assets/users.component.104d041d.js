import{h as D,d as A,S as O,U as E,a as re,g as ne,e as z,I as oe,R as ie}from "./index.e5fa85cd.js";import{ae as V,r,a5 as a,b as o,F as K,j as e,B as g,aK as le,D as q,n as p,S as M,e as w,ar as b,a7 as F,b2 as ce,_ as T,X as de,U as ue,c as me,a$ as pe,b0 as he,b1 as ge,aG as fe,aQ as be,m as Se,a3 as ye,A as P,ab as Ce,ag as xe}from "./vendor.b3bf9397.js";import{T as Ie}from "./table-search.component.d892e67b.js";import{N as Fe}from "./new-button.component.d06ba8e7.js";import{O as Oe}from "./index.3f605551.js";const B=({user:d})=>{const{loadData:S}=D(),[i,y]=r.exports.useState(!1),[u]=a.useForm(),[h,l]=r.exports.useState(!1),{uuid:C,first_name:x,office_id:m,roles:f}=d,{options:{offices:c,roles:n}}=A(),N=async k=>{l(!0);try{const I=await E.put(C,k);console.log(I),l(!1),p.success({message:"Success!",description:I.message}),S()}catch(I){console.error(I),p.error({message:"Error!",description:I.response.data.message}),l(!1)}};return o(K,{children:[e(g,{shape:"circle",icon:e(le,{}),onClick:()=>y(!i)}),e(q,{title:`User: ${x}`,open:i,extra:e(g,{loading:h,type:"primary",htmlType:"submit",onClick:u.submit,children:"Submit"}),closable:!0,onClose:()=>y(!1),children:o(a,{form:u,onFinish:N,layout:"vertical",initialValues:{office_id:m,roles:[...f.map(({id:k})=>k)]},children:[e(a.Item,{label:"Office",name:"office_id",rules:[{required:!0,message:"This field is required"}],children:e(O,{options:c})}),e(a.Item,{label:"Roles",name:"roles",rules:[{required:!0,message:"This field is required"}],children:e(O,{options:n,mode:"multiple"})})]})})]})};B.propTypes={user:V.exports.object};const $=({onClose:d,visible:S})=>{const[i]=a.useForm(),[y,u]=r.exports.useState([]),[h,l]=r.exports.useState(!1),{loadData:C}=D(),{options:{offices:x,roles:m}}=A(),f=async c=>{l(!0);try{const n=await E.post(c);console.log(n),p.success({message:"Success!",description:n.message}),i.resetFields(),l(!1),C()}catch(n){p.error({message:"Error",description:n.response.data.message}),l(!1)}};return r.exports.useEffect(()=>{(async()=>{try{const n=await re.get("/colors");u(n.data)}catch{}})()},[]),e(q,{title:"New User",open:S,onClose:d,forceRender:!0,width:720,extra:e(M,{children:e(g,{onClick:i.submit,type:"primary",loading:h,children:"Submit"})}),children:o(a,{form:i,layout:"vertical",initialValues:{username:"",first_name:"",last_name:"",position:"",office_id:"",email:"",contact_number:"",roles:[]},onFinish:f,children:[o(w,{gutter:16,children:[e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Username",name:"username",rules:[{required:!0}],children:e(F,{prefix:"@"})})}),e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Roles",name:"roles",rules:[{required:!0}],children:e(O,{options:m,mode:"multiple"})})})]}),o(w,{gutter:16,children:[e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"First Name",name:"first_name",rules:[{required:!0}],children:e(F,{})})}),e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Last Name",name:"last_name",rules:[{required:!0}],children:e(F,{})})})]}),o(w,{gutter:16,children:[e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Office",name:"office_id",rules:[{required:!0}],children:e(O,{options:x})})}),e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Position",name:"position",rules:[{required:!0}],children:e(F,{})})})]}),o(w,{gutter:16,children:[e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Email Address",name:"email",rules:[{required:!0}],children:e(F,{})})}),e(b,{span:12,children:e(a.Item,{hasFeedback:!0,label:"Contact Number",name:"contact_number",rules:[{required:!0}],children:e(F,{})})})]})]})})};$.propTypes={onClose:V.exports.func,visible:V.exports.bool};const G=({user:d})=>{var m,f;const[S,i]=r.exports.useState(!1),[y,u]=r.exports.useState(!1),[h]=a.useForm(),{loadData:l}=ne(),{options:{offices:C}}=A(),x=async c=>{u(!0);try{const n=await E.assignOffices(d.uuid,c);p.success({message:z.SUCCESS_MESSAGE,description:n.message}),u(!1),l()}catch(n){p.success({message:z.ERROR_MESSAGE,description:n.response.data.message}),u(!1)}};return o(K,{children:[e(g,{icon:e(ce,{}),shape:"circle",onClick:()=>i(!0)}),e(q,{title:`Assign Offices: ${d.fullname}`,open:S,closable:!0,onClose:()=>i(!1),extra:e(g,{"aria-label":"open",loading:y,type:"primary",onClick:h.submit,children:"Submit"}),children:e(a,{form:h,onFinish:x,layout:"vertical",initialValues:{offices:(f=(m=d.reviews)==null?void 0:m.map(({id:c})=>c))!=null?f:[]},children:e(a.Item,{name:"offices",label:"Offices",children:e(O,{options:C,mode:"multiple"})})})})]})},Ae=()=>{const[d,S]=r.exports.useState(1),[i,y]=r.exports.useState(10),[u,h]=r.exports.useState(!1),[l,C]=r.exports.useState(""),[x,m]=r.exports.useState(!1),[f,c]=r.exports.useState(!1),[n]=a.useForm(),{state:{data:N,pagination:k,loading:I},loadData:j}=D(),{options:{roles:H}}=A();r.exports.useEffect(()=>{U()},[d,l,i]);const Q=({current:t,pageSize:s})=>{S(t),y(s)},W= t=>C(t),X=()=>h(!1),J=async({uuid:t})=>{try{const s=await E.delete(t);U(),p.success({message:"Success!",description:s.message})}catch(s){console.error(s),p.error({message:"Error!",description:s.response.data.message})}},U=()=>{j(d,l,i),v([])},[_,v]=r.exports.useState([]),Y={selectedRowKeys:_,onChange: t=>{console.log("selectedRowKeys changed: ",_),v(t)},selections:[T.SELECTION_ALL,T.SELECTION_INVERT,T.SELECTION_NONE]},Z=[{title:"Full Name / Position",dataIndex:"fullname",key:"fullname",render:(t, s)=>o("span",{children:[s.last_name+", "+s.first_name,e("br",{}),e("small",{children:s.position})]})},{title:"Email",dataIndex:"email",key:"email",render: t=>e(fe,{title:t,children:e(be,{onClick:()=>{Se.success("Copied email!"),ye(t)}})}),align:"center"},{title:"Username",dataIndex:"username",key:"username",align:"center"},{title:"Office",dataIndex:"office",key:"office",render:(t, {office:s})=>e(P,{style:{backgroundColor:s==null?void 0:s.color},children:s==null?void 0:s.acronym}),align:"center"},{title:"Roles",dataIndex:"roles",key:"roles",render:(t, {roles:s})=>s==null?void 0:s.map(R=>R.name).join(", "),align:"center"},{title:"For Review",dataIndex:"reviews",key:"reviews",align:"center",render:(t, s)=>{var R;return t.length?o(P.Group,{maxCount:2,children:[e(G,{user:s}),t.map((L, ae)=>e(Oe,{office:L,children:e(P,{style:{backgroundColor:L.color},children:L.acronym})},ae))]}):((R=s.all_roles)==null?void 0:R.includes(ie.PIP_REVIEWER))&&e(G,{user:s})}},{title:"Actions",dataIndex:"actions",key:"actions",align:"center",render:(t, s)=>o(M,{children:[e(B,{user:s}),e(Ce,{title:"Are you sure you want to delete this user?",onConfirm:()=>J(s),placement:"topRight",children:e(g,{icon:e(xe,{}),danger:!0,shape:"circle"})})]})}],ee=async t=>{c(!0);try{const s=await E.assignRoles({...t,users:_});c(!1),j(),p.success({message:"Success!",description:s.message}),v([]),m(!1)}catch(s){c(!1),p.error({message:"Error!",description:s.response.data.message})}},[se,te]=r.exports.useState("small");return o(r.exports.Fragment,{children:[e(de,{title:o("span",{children:[e(ue,{})," Users"]}),extra:o(r.exports.Fragment,{children:[_.length>0&&e(g,{onClick:()=>m(!0),children:"Assign Role"}),e(Ie,{onSearch:W}),e(g,{icon:e(me,{}),onClick:U}),e(Fe,{onClick:()=>h(!0)}),e(pe,{options:[{value:"small",icon:e(he,{})},{value:"middle",icon:e(ge,{})}],onChange: t=>te(t)})]})}),o(oe,{children:[e(T,{rowSelection:Y,loading:I,dataSource:N,pagination:{...k,position:["bottomCenter"]},onChange:Q,columns:Z,tableLayout:"fixed",size:se}),e($,{visible:u,onClose:X}),e(q,{open:x,title:"Assign Roles",extra:e(g,{loading:f,type:"primary",onClick:n.submit,children:"Submit"}),onClose:()=>m(!1),children:e(a,{form:n,layout:"vertical",onFinish:ee,initialValues:[{roles:[]}],children:e(a.Item,{label:"Roles",name:"roles",rules:[{required:!0,message:"This field is required"}],children:e(O,{options:H,mode:"multiple"})})})})]})]})};export{Ae as default};
