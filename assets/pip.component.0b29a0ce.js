import{u as L,j as t,_ as J,A as g,b as d,aJ as v,a0 as W,h as Y,o as j,M as B,aK as K,ag as X,aM as Z,aY as D,aG as q,J as Q,n as T,r as i,X as ee,F as te,t as ae,aZ as ne,a_ as oe,a$ as se,b0 as le,B as re,an as ie,G as de,m as ce}from"./vendor.a7738c92.js";import{T as me}from"./table-search.component.0d4a6f73.js";import{c as _,d as ge,C as E,P as ue,b as he,u as R,R as ye,I as pe,a as ke}from"./index.e6e712f2.js";import{D as we,R as Pe}from"./download-button.component.b6384217.js";import{N as be}from"./new-button.component.600344dd.js";import{U as A}from"./index.737e40ac.js";import{O as fe}from"./index.362749ad.js";const Ce=({data:o,pagination:c,loading:u,onChange:h,size:m})=>{const y=L(),{loadData:p}=_(),k=async({uuid:e})=>{Q.confirm({title:"Are you sure you want to delete this project?",onOk:async()=>{try{const a=await ue.delete(e);T.success({message:"Success",description:a.message}),p()}catch(a){T.error({message:"Error",description:a.response.data.message})}}})},s=e=>y(`/pips/${e.uuid}`);return ge(),t(J,{loading:u,dataSource:o,pagination:c,columns:[{title:"Office",dataIndex:"office",key:"office",render:e=>e&&t(fe,{office:e,children:t(g,{style:{backgroundColor:e.color},children:e.acronym})}),align:"center",width:"5%",filterSearch:!0},{title:"Title",dataIndex:"title",key:"title",width:"40%"},{title:"Issues/ Comments",dataIndex:"comments_count",key:"comments_count",align:"center",render:(e,a)=>a.issues+" / "+a.comments},{title:"PIPS Status",dataIndex:"pips_status",key:"pips_status",render:e=>{var a;return d(v,{color:e==null?void 0:e.color,children:[(a=e==null?void 0:e.name)==null?void 0:a.toLowerCase()," "]})},align:"center"},{title:"Validated?",dataIndex:"passes_validation",key:"passes_validation",render:e=>e?t(W,{style:{color:E.green}}):"",align:"center"},{title:"PIPOL Status",dataIndex:"pipol_status",key:"pipol_status",render:e=>{var a;return t(v,{color:e==null?void 0:e.color,children:(a=e==null?void 0:e.name)==null?void 0:a.toLowerCase()})},align:"center"},{title:"Last Updated",dataIndex:"updated_at",key:"updated_at",render:e=>Y(e).fromNow(),align:"center"},{title:"Added by",dataIndex:"user",key:"user",render:e=>t(A,{user:e,children:t(g,{style:{backgroundColor:e.color},children:e.avatar})}),align:"center"},{title:"Reviewers",dataIndex:"reviewers",key:"reviewers",align:"center",render:(e,a)=>{var l;return t(g.Group,{children:(l=a.reviewers)==null?void 0:l.map((r,w)=>t(A,{user:r,children:t(g,{style:{backgroundColor:r.color},children:r.avatar})},w))})}},{title:"Actions",key:"actions",render:(e,a)=>t(j.Button,{overlay:t(B,{style:{width:150},items:[{label:"Edit",key:1,icon:t(K,{}),onClick:()=>s(a),disabled:!a.permissions.update},{label:"Delete",key:2,icon:t(X,{}),onClick:()=>k(a),disabled:!a.permissions.delete},{label:"Print",key:3,icon:t(Z,{}),onClick:()=>window.open(`/pips/${a.uuid}/print`)}]})}),align:"center"},{title:t(D,{}),dataIndex:"is_locked",key:"is_locked",render:e=>e&&t(q,{title:"Project is locked and cannot be modified",placement:"topRight",children:t(D,{style:{color:E.red}})})}],onChange:h,style:{marginBottom:16},size:m})},Ie="Programs and projects where the user's office is tagged as owner/encoder will appear here. For any issue/concern, please contact IPD.",Se=()=>alert(Ie),Ae=()=>{var x,O;const{state:{currentUser:o}}=he(),{state:{data:c,pagination:u,loading:h},setPage:m,setPageSize:y,page:p,pageSize:k,sort:s,setSort:C,search:e,setSearch:a,loadData:l}=_(),r=({current:n,pageSize:b})=>{m(n),y(b)},w=L(),F=n=>{m(1),a(n)},[M,P]=i.exports.useState(!1),I=n=>C(n.key),N=()=>w("/pips/create");R();const S=[{label:"Office",key:"office_id"},{label:"Title",key:"title"},{label:"PIPS Status",key:"pips_status_id"},{label:"PIPOL Status",key:"pipol_status_id"},{label:"Added by",key:"user_id"},{label:"Last Updated",key:"updated_at"}],U=t(B,{style:{minWidth:120},onClick:I,items:S}),z=async()=>{P(!0);try{const n=await ke.get("/download",{responseType:"blob"});console.log(n);const b=n.headers["content-type"],$=new Blob([n.data],{type:b,encoding:"UTF-8"}),f=document.createElement("a");f.href=window.URL.createObjectURL($),f.download=new Date().getTime()+"_projects.xlsx",f.click(),P(!1)}catch(n){console.log(n.message),ce.error(n.response.data.message),P(!1)}},{hasPassed:G}=R();i.exports.useEffect(()=>{l()},[p,k,e,s]);const[H,V]=i.exports.useState("small");return d(i.exports.Fragment,{children:[t(ee,{title:d(te,{children:[t(ae,{})," PIP/TRIP"]}),extra:d(i.exports.Fragment,{children:[t(me,{value:e,onSearch:F}),t(j.Button,{overlay:U,onClick:I,trigger:"click",icon:t(ne,{}),children:(x=s&&S.find(n=>n.key===s).label)!=null?x:"Sort"}),t(we,{onClick:z,loading:M,disabled:!c.length}),t(Pe,{onClick:()=>l()}),((O=o==null?void 0:o.all_roles)==null?void 0:O.includes(ye.PIP_ENCODER))&&t(be,{onClick:N}),t(oe,{options:[{value:"small",icon:t(se,{})},{value:"middle",icon:t(le,{})}],onChange:n=>V(n)}),t(re,{type:"text",icon:t(ie,{}),onClick:Se})]})}),d(pe,{children:[G&&t(de,{type:"error",showIcon:!0,message:"The deadline has passed. Only REVIEWERS can update PAP. You can monitor progress of review instead.",style:{marginBottom:16}}),t(Ce,{data:c,onChange:r,pagination:{...u,position:["bottomCenter"]},loading:h,size:H})]})]})};export{Ae as default};
